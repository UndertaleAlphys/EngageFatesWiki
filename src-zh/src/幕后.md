# 幕后实现说明

本 Mod 并不仅仅包含内容与数值调整。

为了支持其整体设计目标，我们使用了一个自定义的 Skyline 插件，对《Fire Emblem Engage》的部分运行时行为进行了扩展与调整。  
本页面将从技术角度介绍 **具体实现了哪些内容，以及为什么要这样做**，不要求读者具备相关源码背景。

---

## 1. 文件完整性与稳定性

为了在开发与测试过程中减少不可预期的行为：

- 插件会在启动时对 Mod 文件执行 **完整性校验**
- `IF mod (Cobalt)` 目录下的文件会与预先记录的哈希值进行比对
- 若检测到不一致，将直接在启动阶段报错，而不是继续运行

这一机制的目的是为复杂的运行时逻辑提供一个**稳定、可预测的基础环境**。

---

## 2. 职业转换与技能习得逻辑

职业转换系统中的多个关键行为由插件明确处理：

- 晋级与转职流程被统一规范
- 等级变化被显式控制，以避免边缘情况
- 动态等级缩放被有意禁用

### 职业技能的处理方式

插件为职业技能制定了一套一致的规则：

- 当角色习得某职业的职业技能后，  
  **一旦转出该职业**，该技能将进入可自由装备的继承技能池
- 当角色**转回原职业**时：
  - 角色会立刻重新学会该职业的职业技能
- 对于已达到等级上限、无法继续升级的情况，也进行了额外处理

这一设计旨在让技能的获得与切换行为更加直观、可理解。

---

## 3. 战斗计算流程的扩展

部分战斗计算并非仅通过数据修改完成，而是在运行时对计算流程进行了扩展：

- 命中、回避、必杀、必杀回避等公式被调整
- 追击条件被重新定义
- 武器相克效果被统一处理
- 地形与支援修正被整合到一致的判定逻辑中

这些调整的目标并非单纯改变强度，而是让战斗结果更加清晰、可预测。

---

## 4. 结合气与 SP 行为

### 结合气

- 原有部分结合气累积逻辑被抑制
- 结合气的获取改为基于以下行为进行计算：
  - 主动发起战斗
  - 击败敌人
  - 单次行动中同时满足上述条件

### SP 系统

- SP 的获取不再依赖是否装备纹章士
- 角色获得的 **SP 等于获得的 EXP**

这些规则通过运行时逻辑统一执行，以保证在各种场景下的一致性。

---

## 5. 炮台系统的调整

地图炮台系统进行了多项改进：

- 炮弹不再消耗
- 剩余弹药显示为无限
- 支持多目标选择
- 不同类型炮台的射程显示方式被统一

目标选择逻辑也进行了调整，使其更贴近实际战斗影响。

---

## 6. 技能行为的修正与扩展

对部分技能行为进行了修正或补充：

- **再移动＋＋** 改为提供剩余移动力
- Style Bonus 变体技能在条件变化时能够正确切换与卸除
- 地形有效性判定在伤害、回复与站位逻辑中统一
- 武器熟练度判定被扩展以支持自定义资质规则

这些改动主要集中在行为一致性与正确性上。

---

## 7. 道具逻辑扩展

在必要的场景下，对道具行为进行了扩展：

- 可通过附带技能标签覆盖治疗量
- 部分祝福类道具放宽了可使用条件
- 在受控场景中，适当放宽了道具使用限制

所有调整均基于运行时条件进行判定。

---

## 8. 脚本与事件扩展

插件为事件脚本提供了额外的功能接口：

- 可直接操作结合气、回合数与牵绊等级
- 提供更复杂的目标筛选逻辑（如妨害目标选择）
- 支持自定义地图效果与条件判断
- 提供用于特定关卡的实用函数

这些扩展使复杂机制可以通过脚本表达，而无需硬编码在关卡中。

---

## 9. 有意限制的系统

出于整体设计与节奏考虑，一些系统被有意限制或禁用：

- 井系统
- 投资系统
- 游击战

这些调整是 Mod 整体设计的一部分。

---

## 总结

该插件作为 Mod 的**技术支撑框架**：

- 对现有系统进行了有限而明确的扩展
- 处理了一些难以通过数据层解决的边缘问题
- 为整体机制提供了更稳定、可控的实现方式

其目标并非替代原有系统，而是在尊重原设计的基础上，  
**对其进行谨慎而必要的调整**。